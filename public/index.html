
<!DOCTYPE html>
<html lang="en" ng-app="app">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="/css/bootstrap-theme.min.css">
	<link rel="stylesheet" type="text/css" href="/css/loading-bar.min.css">
	<script src="/scripts/angular.min.js"></script>
	<script src="/scripts/loading-bar.min.js"></script>
	<script src="/scripts/ui-bootstrap-tpls.min.js"></script>
	<script>
		angular.module('app', ['ui.bootstrap', 'angular-loading-bar'])
		.config(['cfpLoadingBarProvider', function(cfpLoadingBarProvider) {
			cfpLoadingBarProvider.includeSpinner = false;
		}])
		.config(['$httpProvider', function ($httpProvider) {
			$httpProvider.interceptors.push('Interceptor');
		}])
		.factory('Interceptor', [ '$q', function ($q) {
		    return {
		    	response:function (response) {
		    		if (typeof response.data == 'string' && response.data.indexOf('attendance-marked')>-1) {
		    			response.data='Attendance recorded successfully for '+response.data.substring(18,20)+' shift.';
		    		} else if (typeof response.data == 'string' && response.data.indexOf('owner-updated')>-1) {
		    			response.data='Shift owner has been updated for '+response.data.substring(14,16)+' shift.';
		    		}
		    		return response;
		    	},
		    	responseError:function (response) {
		    		if (response.data == 'passphrase-incorrect') {
		    			response.data='Passphrase incorrect. Please try again with correct passphrase.';
		    		} else if (response.data == 'admin-passphrase-incorrect') {
		    			response.data='You are not authorized to edit the roster.';
		    		} else if (response.data == 'db-error') {
		    			response.data='Database error occurred at server.';
		    		} else if (typeof response.data == 'string' && response.data.indexOf('attendance-already-marked')>-1) {
		    			response.data='Attendance is already recorded for '+response.data.substring(26,28)+' shift.';
		    		} else if (response.data == 'member-details-not-found') {
		    			response.data='Member details were not found in database.';
		    		} 
		    		return $q.reject(response);
		    	}
		    };
		}])
		.factory('Service', ['$http', function($http) {
			var service = {};
			service.getMembers = function() {
				return $http({
					method: 'GET',
					url: '/members',
				});
			};
			service.getReport = function (startDate,endDate) {
				return $http({
					method: 'GET',
					url: '/report',
					params: {
						startYear:startDate.getFullYear(),
						startMonth:startDate.getMonth(),
						startDay:startDate.getDate(),
						endYear:endDate.getFullYear(),
						endMonth:endDate.getMonth(),
						endDay:endDate.getDate()
					}
				});
			};
			service.enterAttendance = function(data) {
				return $http({
					method: 'POST',
					url: '/enter',
					data: data
				});
			};
			service.getShiftDetails = function() {
				return $http({
					method: 'GET',
					url: '/shiftDetails'
				});
			};
			service.authorizeRosterEdit = function(passphrase) {
				return $http({
					method: 'POST',
					url: '/authorizeRosterEdit',
					data: {
						passphrase: passphrase
					}
				})
			};
			service.getMembersInShift = function(shiftDetails) {
				return $http({
					method: 'GET',
					url: '/membersInShift',
					params: {
						shift: shiftDetails.shift,
						year: shiftDetails.year,
						month: shiftDetails.month,
						day: shiftDetails.day
					}
				});
			};
			service.deleteEntry = function(shiftDetails, memberId) {
				return $http({
					method: 'POST',
					url: '/deleteEntry',
					data: {
						shift: shiftDetails.shift,
						year: shiftDetails.year,
						month: shiftDetails.month,
						day: shiftDetails.day,
						memberId: memberId
					}
				});
			};
			service.addShiftOwner = function(shift, year, month, day, shiftOwner, passphraseShiftOwner) {
				return $http({
					method: "POST",
					url: '/updateOwner',
					data: {
						shift: shift,
						year: year,
						month: month,
						day: day,
						memberId: shiftOwner,
						passphrase: passphraseShiftOwner
					}
				});
			};
			service.getOwner = function(shiftDetails) {
				return $http({
					method: "GET",
					url: "/getOwner",
					params: {
						shift: shiftDetails.shift,
						year: shiftDetails.year,
						month: shiftDetails.month,
						day: shiftDetails.day
					}
				})
			};
			service.bridgeEntry = function(input,year,month,day){
				return $http({
					method: "POST",
					url: "/enterBridge",
					data:{
						bridgename: input.bridgename,
						bridgeType:input.bridgeType,
						bridgeTime:input.bridgeTime,
						shift:input.shift,
						selectkeywords:input.selectkeywords,
						year: year,
						month: month,
						day: day,
						duration: input.duration,
						primaryParticipants: input.participantsPrimary,
						secondaryParticipants:input.participantsSecondary,
						briefsummary: input.briefsummary,
						solution: input.solution,
						contactDL:input.contactDL,
						OBUjira: input.OBUjira,
						SGjira: input.SGjira,
						RCAjira: input.RCAjira
					}
				})
			};
				service.trackBridge = function (startDate,endDate) {
				return $http({
					method: 'GET',
					url: '/bridgeSearch',
					params: {
						startYear:startDate.getFullYear(),
						startMonth:startDate.getMonth(),
						startDay:startDate.getDate(),
						endYear:endDate.getFullYear(),
						endMonth:endDate.getMonth(),
						endDay:endDate.getDate()
					}
				});
			};

			return service;

		}])
		.controller('AttendanceController', ['$scope','Service', function ($scope,Service) {
			$scope.reportEditButtonText = "Login as Admin";
			$scope.showDrop = "false";
			$scope.reportView = "true";
			$scope.bridgeMandatoryFieldsError =false;
			$scope.bridgeSuccess = false;
			$scope.isDisabled = false;
			$scope.showBridgeReport = true;
			var logResponseToConsole = function(response) {
				console.log(response.data);
			};
			var updateMembersInShift = function(shiftDetails) {
				$scope.membersInCurrentShift = [];
				$scope.membersInPreviousShift = [];
				Service.getShiftDetails()
					.then(function(response) {
						if (!shiftDetails || angular.equals(shiftDetails, response.data.currentShift)) {
							var currentShiftDetails = response.data.currentShift;
							var previousShiftDetails = response.data.previousShift;
							if (!shiftDetails) {
								$scope.inputs.date = new Date(currentShiftDetails.year, currentShiftDetails.month, currentShiftDetails.day);
								$scope.inputs.shift = currentShiftDetails.shift;
							}
							Service.getMembersInShift(currentShiftDetails)
								.then(function(response) {
									$scope.membersInCurrentShift = response.data;
								}, logResponseToConsole);
							Service.getOwner(currentShiftDetails)
								.then(function(response) {
									$scope.currentShiftOwner = response.data.name;
								}, function(errorResponse) {
									$scope.currentShiftOwner = '';
								});
							if (!response.data.previousShiftEnded) {
								Service.getMembersInShift(previousShiftDetails)
									.then(function(response) {
										$scope.membersInPreviousShift = response.data;
									}, logResponseToConsole);
								Service.getOwner(previousShiftDetails)
									.then(function(response) {
										$scope.previousShiftOwner = response.data.name;
									}, function(errorResponse) {
										$scope.previousShiftOwner = '';
									});
							}
						} else {
							$scope.membersInPreviousShift = [];
							$scope.currentShiftOwner = '';
							$scope.previousShiftOwner = '';
							Service.getMembersInShift(shiftDetails)
								.then(function(response) {
									$scope.membersInCurrentShift = response.data;
								}, logResponseToConsole);
							Service.getOwner(shiftDetails)
								.then(function(response) {
									$scope.currentShiftOwner = response.data.name;
								}, function(errorResponse) {
									$scope.currentShiftOwner = '';
								});
						}
					}, logResponseToConsole);
			};
			var addDays=function(date, days) {
				var result = new Date(date);
				result.setDate(date.getDate() + days);
				return result;
			};
			var updateReport=function (startDate,endDate) {
				if (!startDate || !endDate) {
					Service.getShiftDetails()
					.then(function (response){
						$scope.inputs.report.endDate = new Date(response.data.currentShift.year,response.data.currentShift.month,response.data.currentShift.day);
						$scope.inputs.report.startDate = addDays($scope.inputs.report.endDate,-7);
						updateReport($scope.inputs.report.startDate, $scope.inputs.report.endDate);
					},logResponseToConsole);
				} else {
					Service.getReport(startDate,endDate)
					.then(function (response){
						$scope.report=response.data;
						var ownerArray=[];
						var report = $scope.report;
                        var shifts=['S1','S2','S3'];
                        for (var i = report.length - 1; i >= 0; i--) {
	                         for (var j = shifts.length - 1; j >= 0; j--) {
		                           var ownerfortheshift = report[i][shifts[j]].owner;
                                    if(ownerfortheshift){
                                    ownerArray.push(ownerfortheshift);
                                    } 
	                            };
                        };
                     if(ownerArray && ownerArray.length >0){
                       var ownerCount = ownerArray.reduce(function (acc, curr) {
                           if (typeof acc[curr] == 'undefined') {
                              acc[curr] = 1;
                           } else {
                              acc[curr] += 1;
                           }
                        return acc;
                       }, {});
                     }
                    $scope.ownerCounts = ownerCount;
                    $scope.ownerError = "false";
                    if(ownerCount === "" ||ownerCount === "undefined" || !ownerCount){
                         $scope.ownerError = "true";
                    }
					},function (errorResponse){
						$scope.reportError=errorResponse.data;
					});
				}
			};
			$scope.inputs={
				report:{}
			};
			$scope.report=[];
			$scope.bridgeReport=[];

			$scope.shifts = [{
				shiftNo: 'S1',
				shiftTiming: 'S1 - 03:00am to 12:15pm CST'
			}, {
				shiftNo: 'S2',
				shiftTiming: 'S2 - 10:15am to 07:30pm CST'
			}, {
				shiftNo: 'S3',
				shiftTiming: 'S3 - 07:00pm to 04:15am CST'
			}];

			$scope.bridgeTypes = [{
				type: 'Production Issue',
				id: '1'
			}, {
				type: 'Deployment',
				id: '2'
            }, {
				type: 'Internal Bridge',
				id: '3'
            }];
			$scope.keywords = [{
				keywordName: 'FE',
				id: '1'
			}, {
				keywordName: 'SAL',
				id: '2'
			},{
				keywordName: 'UC',
				id: '3'
			},{
				keywordName: 'UPAS',
				id: '4'
			},{
				keywordName: 'Deployment',
				id: '5'
			},{
				keywordName: 'Telluride',
				id: '6'
			},{
				keywordName: 'SCIM',
				id: '7'
			},{
				keywordName: 'OMS',
				id: '8'
			},{
				keywordName: 'Other Third Party',
				id: '9'
			},{
				keywordName: 'Server issues',
				id: '10'
			},{
				keywordName: 'All bridges',
				id: '11'
			},{
				keywordName: 'Other issues',
				id: '12'
			},{
				keywordName: 'URL Poll Failures',
				id: '13'
			},{
				keywordName: 'SHARP',
				id: '14'
			},{
				keywordName: 'Browse',
				id: '15'
			},{
				keywordName: 'WCS',
				id: '16'
			},{
				keywordName: 'Bin Lookup',
				id: '17'
			},{
				keywordName: 'IRS',
				id: '18'
			},{
				keywordName: 'ISS',
				id: '19'
			},{
				keywordName: 'PostOrder',
				id: '20'
			},{
				keywordName: 'PROFILE',
				id: '21'
			},{
				keywordName: 'RDM',
				id: '22'
			},{
				keywordName: 'SOLRX',
				id: '23'
			},{
				keywordName: 'SPIN',
				id: '24'
			},{
				keywordName: 'Taxware',
				id: '24'
			},{
				keywordName: 'DPS',
				id: '25'
			}];
			$scope.disableRosterEditMode=function () {
				$scope.rosterEditModeOn = false;
				$scope.rosterEditButtonText='Edit Roster';
			};
			$scope.enableRosterEditMode=function () {
				$scope.rosterEditModeOn = true;
				$scope.rosterEditButtonText='Done';
			};
			$scope.resetAlerts=function () {
				$scope.attendanceError = '';
				$scope.attendanceSuccess = '';
				$scope.shiftOwnerSuccess = '';
				$scope.shiftOwnerError = '';
				$scope.rosterEditError = '';
			};
			$scope.resetPassphrases=function () {
				$scope.inputs.passphrase='';
				$scope.inputs.ownerPassphrase='';
				$scope.inputs.adminPassphrase='';
			}
			$scope.resetMember=function () {
				$scope.inputs.memberId='';
				$scope.inputs.ownerId='';
			}
			$scope.enterAttendance = function(inputs) {
				$scope.resetAlerts();
				if (inputs && inputs.memberId && inputs.passphrase) {
					Service.enterAttendance({memberId:inputs.memberId,passphrase:inputs.passphrase})
						.then(function(response) {
							$scope.attendanceSuccess = response.data;
							$scope.resetPassphrases();
							updateMembersInShift();
							updateReport();
						}, function(errorResponse) {
							$scope.attendanceError = errorResponse.data;
							$scope.resetPassphrases();
						});
				} else {
					$scope.attendanceError = 'Select a name and enter passphrase.';
				} 
			};
			$scope.deleteEntry = function(memberId) {
				$scope.resetAlerts();
				Service.deleteEntry({
						shift: $scope.inputs.shift,
						year: $scope.inputs.date.getFullYear(),
						month: $scope.inputs.date.getMonth(),
						day: $scope.inputs.date.getDate()
					}, memberId)
					.then(function(response) {
						updateMembersInShift();
						updateReport();
					}, function(errorResponse) {
						$scope.rosterEditError = errorResponse.data;
					});
			};
			$scope.markShiftOwner = function(inputs) {
				$scope.resetAlerts();
				var year = inputs.date.getFullYear();
				var month = inputs.date.getMonth();
				var day = inputs.date.getDate();
				if (inputs && inputs.ownerId && inputs.ownerPassphrase) {
					Service.addShiftOwner(inputs.shift, year, month, day, inputs.ownerId, inputs.ownerPassphrase)
						.then(function(response) {
							$scope.shiftOwnerSuccess = response.data;
							$scope.resetPassphrases();
							updateMembersInShift();
							updateReport();
						}, function(errorResponse) {
							$scope.shiftOwnerError = errorResponse.data;
							$scope.resetPassphrases();
						});
				} else {
					$scope.shiftOwnerError = "Select a name and enter passphrase."
				}

			};
			$scope.authorizeRosterEdit = function(inputs) {
				$scope.resetAlerts();
				if ($scope.rosterEditModeOn) {
					$scope.disableRosterEditMode();
				} else if (inputs && inputs.adminPassphrase) {
					Service.authorizeRosterEdit(inputs.adminPassphrase)
					.then(function (response){
						$scope.resetPassphrases();
						$scope.enableRosterEditMode();
					},function (errorResponse){
						$scope.rosterEditError=errorResponse.data;
						$scope.resetPassphrases();
					});
				} else{
					$scope.rosterEditError='Enter admin passphrase to edit roster.';
				}
			};
			$scope.$watch('inputs.date', function(newDate,oldDate) {
				if (newDate && oldDate && !angular.equals(newDate, oldDate)) {
					var shiftDetails = {
						shift: $scope.inputs.shift,
						year: newDate.getFullYear(),
						month: newDate.getMonth(),
						day: newDate.getDate()
					};
					updateMembersInShift(shiftDetails);
					$scope.inputs.report.endDate=newDate;
					$scope.inputs.report.startDate=addDays($scope.inputs.report.endDate,-7);
				}
			});
			$scope.$watch('inputs.shift', function(newShift,oldShift) {
				if (newShift && oldShift && !angular.equals(newShift, oldShift)) {
					var shiftDetails = {
						shift: newShift,
						year: $scope.inputs.date.getFullYear(),
						month: $scope.inputs.date.getMonth(),
						day: $scope.inputs.date.getDate()
					};
					updateMembersInShift(shiftDetails);
				}
			});
			$scope.$watch('inputs.report.startDate', function(newDate, oldDate) {
				if (newDate && oldDate && !angular.equals(newDate, oldDate)) {
					updateReport(newDate,$scope.inputs.report.endDate);
				} 
			});
			$scope.$watch('inputs.report.endDate', function(newDate, oldDate) {
				if (newDate && oldDate && !angular.equals(newDate, oldDate)) {
					updateReport($scope.inputs.report.startDate,newDate);
				} 
			});
			$scope.authorizeReportView = function(data){
				if (data) {
					Service.authorizeRosterEdit(data)
					.then(function (response){
						$scope.showDrop = "true" ;
						$scope.inputs.adminPassphrase = '';

					},function (errorResponse){
                      console.log(errorResponse);
                      $scope.inputs.adminPassphrase = '';
					});
				}

			};
		 $scope.submitBridge = function(input){
		 	$scope.errorMessageBridge = "Please Fill all the mandatory fields(*) before submitting";
		 	$scope.bridgeMandatoryFieldsError =false;
			$scope.bridgeSuccess = false;
		 	     if(!input){
                    $scope.bridgeMandatoryFieldsError = true;
                    return false;
		 	      }
                if(input.bridgename ===""  || input.bridgename === undefined 
                  ||input.dateOfbridge==="" ||input.dateOfbridge=== undefined
                	|| input.duration ==="" || input.duration=== undefined 
                	|| input.participantsPrimary==="" || input.participantsPrimary=== undefined
                	|| input.briefsummary ==="" ||input.briefsummary=== undefined
                	|| input.solution==="" || input.solution === undefined
                	||input.bridgeType ==="" || input.bridgeType === undefined
                	||input.bridgeTime ==="" || input.bridgeTime === undefined
                	||input.shift ==="" || input.shift === undefined){
                           $scope.bridgeMandatoryFieldsError = true;
                 }else if(input.selectkeywords === undefined ||(input.selectkeywords && input.selectkeywords.length === 0)){
                         $scope.bridgeMandatoryFieldsError = true;
                 }else{
                 	$scope.isDisabled = true;
                 	$scope.bridgeMandatoryFieldsError = false;
                 	if(input.OBUjira ==="" ||input.OBUjira === undefined){
                 		input.OBUjira="NA";
                 	}
                 	if(input.SGjira === "" ||input.SGjira ===  undefined){
                 		input.SGjira="NA";
                 	}
                 	if(input.RCAjira ===""|| input.RCAjira === undefined){
                 		input.RCAjira="NA";
                 	}
                 	if(input.contactDL ===""|| input.contactDL === undefined){
                 		input.contactDL="NA";
                 	}
                 	if(input.participantsSecondary === ""
                 		|| input.participantsSecondary=== undefined){
                 		input.participantsSecondary="NA";
                 	}
                 	if(input.shift ==="S3"){
				    input.dateOfbridge.setDate(input.dateOfbridge.getDate()-1);
				    }
                 	var year = input.dateOfbridge.getFullYear();
				    var month = input.dateOfbridge.getMonth();
				    var day = input.dateOfbridge.getDate();
                 	Service.bridgeEntry(input,year,month,day)
                 	 .then(function(response){
                        $scope.bridgeDetailsSuccess = response.data;
                        $scope.bridgeSuccess = true;
                        $scope.inputsbridge = [];
                        $scope.isDisabled = false;
                 	 },function(errorResponse){
                       $scope.bridgeMandatoryFieldsError = true;
                       $scope.errorMessageBridge = errorResponse.data;
                       $scope.isDisabled = false;
                 	 });

                 }
             };
             $scope.resetBridge = function(){
             	$scope.inputsbridge = [];
             	$scope.bridgeSuccess = false;
             	$scope.bridgeMandatoryFieldsError =false;
             }
			
			$scope.searchBridge = function(inputsBridgeReport,advanceSearch){
               if(!(inputsBridgeReport==="" ||inputsBridgeReport===undefined)){
                        if(!(inputsBridgeReport.endDate==="" || inputsBridgeReport.endDate=== undefined
                	       ||inputsBridgeReport.startDate ==="" ||inputsBridgeReport.startDate === undefined)){
                	         $scope.bridgesearchFieldsError= false;
                	         Service.trackBridge(inputsBridgeReport.startDate,inputsBridgeReport.endDate)
                	         .then(function(response){
                	         	console.log(response.data);
                	         	$scope.bridgeReport = response.data;
                	         	var bridgeReport = response.data;
                	         	if(bridgeReport && bridgeReport.length >0){
                	         	  for (var i = bridgeReport.length - 1; i >= 0; i--) {
                	         	  	if(bridgeReport[i].showData && bridgeReport[i].showData === true){
                	         	  		$scope.showBridgeReport = true;
                	         	  		break;
                	         	  	}else{
             		 				   $scope.showBridgeReport = false;
             		 			    }                                 
                                  };
                                }else{
                                	$scope.showBridgeReport = false;
                                }
                	         },function(errorResponse){
                        
                 	         });
                	      }else{
                           $scope.bridgesearchFieldsError= true;
                          return false;
                       }
                }
                else{
                    $scope.bridgesearchFieldsError= true;
               }
			};

			$scope.searchAdvance = function(){
               return false;
			};

			$scope.adminOptions = [{
				option: 'Report View'
			}, {
				option: 'ShiftOwner Report View'
			}];

			$scope.disableRosterEditMode();
			Service.getMembers()
				.then(function(response) {
					$scope.members = response.data;
				}, function(errorResponse) {
					$scope.attendanceError = errorResponse.data;
				});
			updateMembersInShift();
			updateReport();
		}])
		.controller('DateController', ['$scope', function ($scope) {
			$scope.openDatePicker = function($event) {
				$event.preventDefault();
				$event.stopPropagation();
				$scope.opened=true;
			};
		}])
		.controller('ReportController', ['$scope','Service', function ($scope,Service) {
			$scope.startDate={};
			$scope.endDate={};
			$scope.startDate.openDatePicker = function($event) {
				$event.preventDefault();
				$event.stopPropagation();
				$scope.startDate.opened=true;
			};
			$scope.endDate.openDatePicker = function($event) {
				$event.preventDefault();
				$event.stopPropagation();
				$scope.endDate.opened=true;
			};
			$scope.orderByDate=function (datum) {
				var date=new Date(datum.date);
				return new Date(date.getFullYear(),date.getMonth(),date.getDate());
			};
			$scope.$watch('adminOption', function(newValue,oldValue) {
				if (newValue && !angular.equals(newValue, oldValue)) {
					if(newValue.option === "ShiftOwner Report View"){
						$scope.reportView = "false";
					}
					else if(newValue.option === "Report View"){
						$scope.reportView = "true";
					}
					else
						return false;
				}
			});
		}]);
	</script>
	<style>
		.page-header{
			background-color: rgb(204, 231, 244);
			margin: 0px;
			padding-bottom: 30px;
			padding-top: 30px;
			padding-left: 10px;
			color: rgb(49, 112, 143);
			text-align: center;
		}
		.align-Center{
			text-align: center;
		}
		.shiftDropdown{
			width: 250px;
		}
		.myclass{
			margin-right: 400px;
            margin-left: 15px;
		}
		.alertClass{
			margin-left: 22%;
		}
		.blueText{
			color: rgb(49, 112, 143);
		}
		.shiftSelect{
			font-weight: bold;
		}
		#recordAttendanceButton,#recordShiftOwnerButton{
			border-top-right-radius: 4px; 
			border-bottom-right-radius: 4px; 
		}
		.table.report tr[ng-repeat-start] td{
			border-top: 1px solid rgb(49, 112, 143);
		}
		.table.report tr[ng-repeat-end] td{
			border-top: 1px solid rgb(49, 112, 143);
		}
		.table.report tr:last-child td{
			border-top: 1px solid rgb(49, 112, 143);
			border-bottom: 1px solid rgb(49, 112, 143);
		}
		.table.report tr[ng-repeat-start] td{
			border-bottom: 1px solid rgb(49, 112, 143);
		}
		.table.report td{
			vertical-align:middle;
		}
	</style>
</head>

<body ng-controller="AttendanceController">
	<h2 class="page-header"><strong>USP Support Shift Details</strong></h2>
	<tabset class="panel panel-heading container">
		<tab heading="Roster">
			<form class="panel-body" name="frmShiftPlan" ng-submit="authorizeRosterEdit(inputs)" novalidate>
				<div class="row">
					<div class="col-md-3">
						<p class="input-group" ng-controller="DateController">
							<input type="text" class="form-control" datepicker-popup="yyyy/MM/dd" ng-model="inputs.date" is-open="opened" ng-required="true" close-text="Close" />
							<span class="input-group-btn">
								<button type="button" class="btn btn-default" ng-click="openDatePicker($event)"><i class="glyphicon glyphicon-calendar"></i></button>
							</span>
						</p>
					</div>
					<div class="col-md-1">
						<select ng-model="inputs.shift" ng-options="shift.shiftNo as shift.shiftTiming for shift in shifts" class="form-control shiftDropdown">
							<option value="">Shift</option>
						</select>
					</div>
					<div class="col-md-4 pull-right" ng-show="membersInCurrentShift.length">
                        <p class="input-group">
                            <input name="adminPass" type="password" class="form-control" placeholder="Enter Admin Passphrase" ng-model="inputs.adminPassphrase" ng-required="true" ng-disabled="rosterEditModeOn" ng-change="resetAlerts();" />
                            <span class="input-group-btn">
                                <button type="submit" class="btn btn-info" ng-disabled="!rosterEditModeOn && frmShiftPlan.adminPass.$error.required">{{rosterEditButtonText}}</button>
                            </span>
                        </p>
					</div>
				</div>
				<alert class="col-md-5" ng-show="!membersInCurrentShift.length && !membersInPreviousShift.length" type="info"><strong>No data available.</strong></alert>
			</form>
			<accordion close-others="false" ng-show="membersInCurrentShift.length || membersInPreviousShift.length">
				<accordion-group is-open="true">
					<accordion-heading>
						<span class="blueText">Members in shift</span>
						<span ng-show="currentShiftOwner" class="pull-right blueText">
						Shift Owner : <b>{{currentShiftOwner}}</b>
						</span>
					</accordion-heading>
					<table class="table table-striped table-condensed" ng-show="membersInCurrentShift.length">
						<thead>
							<tr>
								<th>Location</th>
								<th>Name</th>
								<th>User Name</th>
								<th>Tier</th>
								<th>Role</th>
								<th>Primary Module</th>
								<th>Secondary Module</th>
								<th>Phone 1</th>
								<th>Phone 2</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="member in membersInCurrentShift | orderBy:'name'">
								<td>{{member.location}}</td>
								<td>{{member.name}}</td>
								<td>{{member.username}}</td>
								<td>{{member.tier}}</td>
								<td>{{member.role}}</td>
								<td>{{member.module1}}</td>
								<td>{{member.module2}}</td>
								<td>{{member.phone1}}</td>
								<td>{{member.phone2}}</td>
								<td>
									<button ng-click="deleteEntry(member._id)" ng-show="rosterEditModeOn" class="btn btn-sm btn-info" >
									Delete
									</button>
								</td>
							</tr>
						</tbody>
					</table>
					<span ng-show="!membersInCurrentShift.length">There are no members in the selected shift.</span>
					<alert class="col-md-6" ng-show="rosterEditError" type="danger"><strong>{{rosterEditError}}</strong></alert>
				</accordion-group>
				<accordion-group is-open="true" ng-show="membersInPreviousShift.length">
					<accordion-heading>
						<span class="blueText">Members available from previous shift</span>
						<span ng-show="previousShiftOwner" class="pull-right blueText">
						Shift Owner : <b>{{previousShiftOwner}}</b>
						</span>
					</accordion-heading>
					<table class="table table-striped table-condensed">
						<thead>
							<tr>
								<th>Location</th>
								<th>Name</th>
								<th>User Name</th>
								<th>Tier</th>
								<th>Role</th>
								<th>Primary Module</th>
								<th>Secondary Module</th>
								<th>Phone 1</th>
								<th>Phone 2</th>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="member in membersInPreviousShift | orderBy:'name'">
								<td>{{member.location}}</td>
								<td>{{member.name}}</td>
								<td>{{member.username}}</td>
								<td>{{member.tier}}</td>
								<td>{{member.role}}</td>
								<td>{{member.module1}}</td>
								<td>{{member.module2}}</td>
								<td>{{member.phone1}}</td>
								<td>{{member.phone2}}</td>
							</tr>
						</tbody>
					</table>
				</accordion-group>
			</accordion>
		</tab>
		<tab heading="Record Attendance">
			<form class="panel-body" name="frmAttendanceRecorder" ng-submit="enterAttendance(inputs)" novalidate>
				<div class="row">
					<div class="col-md-3">
						<select ng-model="inputs.memberId" ng-options="member._id as member.name for member in members | orderBy:'name'" class="form-control" ng-change="resetAlerts(); resetPassphrases();">
							<option value=''>Select Name</option>
						</select>
					</div>
					<div class="col-md-4">
						<p class="input-group">
							<input type="password" name="pwdPassphrase" class="form-control" ng-required="true" ng-model="inputs.passphrase" ng-change="resetAlerts()" placeholder="Enter Passphrase"/>
							<span class="input-group-btn">
								<button id="recordAttendanceButton" ng-disabled="frmAttendanceRecorder.pwdPassphrase.$error.required" type="submit" class="btn btn-info">Record Attendance</button><br/>
							</span>
						</p>
					</div>
				</div>
				<alert class="col-md-5" ng-show="attendanceSuccess" type="info"><strong>{{attendanceSuccess}}</strong></alert>
				<alert class="col-md-6" ng-show="attendanceError" type="danger"><strong>{{attendanceError}}</strong></alert>
			</form>
			<form class="panel-body" name="frmOwnerRecorder" ng-submit="markShiftOwner(inputs)" novalidate>
				<div class="shiftSelect">Select the shift owner for the current shift : </div>
				<br>
				<div class="row">
					<div class="col-md-3">
						<select ng-model="inputs.ownerId" ng-options="member._id as member.name for member in membersInCurrentShift | orderBy:'name'" class="form-control" ng-change="resetAlerts(); resetPassphrases();">
							<option value=''>Select Name</option>
						</select>
					</div>
					<div class="col-md-4">
						<p class="input-group">
							<input type="password" name="pwdPassphrase" class="form-control" ng-required="true" ng-model="inputs.ownerPassphrase" ng-change="resetAlerts()" placeholder="Enter Passphrase"/>
							<span class="input-group-btn">
								<button id="recordShiftOwnerButton" ng-disabled="frmOwnerRecorder.pwdPassphrase.$error.required" type="submit" class="btn btn-info">Update ShiftOwner</button><br/>
							</span>
						</p>
					</div>
				</div>
				<alert class="col-md-5" ng-show="shiftOwnerSuccess" type="info"><strong>{{shiftOwnerSuccess}}</strong></alert>
				<alert class="col-md-6" ng-show="shiftOwnerError" type="danger"><strong>{{shiftOwnerError}}</strong></alert>
			</form>
		</tab>
		<tab heading="Report">
			<form class="panel-body" ng-controller="ReportController" ng-submit="" novalidate>
				<div class="row">
					<div class="col-md-4">
						<p class="input-group">
							<span class="input-group-addon"><strong>From : </strong></span>
							<input type="text" class="form-control" datepicker-popup="yyyy/MM/dd" ng-model="inputs.report.startDate" is-open="startDate.opened" ng-required="true" close-text="Close" />
							<span class="input-group-btn">
								<button type="button" class="btn btn-default" ng-click="startDate.openDatePicker($event)"><i class="glyphicon glyphicon-calendar"></i></button>
							</span>
						</p>
					</div>
					<div class="col-md-4">
						<p class="input-group">
							<span class="input-group-addon"><strong>To : </strong></span>
							<input type="text" class="form-control" datepicker-popup="yyyy/MM/dd" ng-model="inputs.report.endDate" is-open="endDate.opened" ng-required="true" close-text="Close" />
							<span class="input-group-btn">
								<button type="button" class="btn btn-default" ng-click="endDate.openDatePicker($event)"><i class="glyphicon glyphicon-calendar"></i></button>
							</span>
						</p>
					</div>
					<div class="col-md-4 pull-right" ng-hide="showDrop">
                        <p class="input-group">
                           <input name="adminPass" type="password" class="form-control" placeholder="Enter Admin Passphrase" ng-model="inputs.adminPassphrase" ng-required="true"/>
                            <span class="input-group-btn">
                                <button type="submit" class="btn btn-info" ng-disabled="frmShiftPlan.adminPass.$error.required"
                                ng-click="authorizeReportView(inputs.adminPassphrase)">{{reportEditButtonText}}</button>
                            </span>
                        </p>
					</div>
					<div class="col-md-4 pull-right" ng-show="showDrop">
						<select ng-model="adminOption" class="form-control shiftDropdown" ng-options="adminOptn.option for adminOptn in adminOptions">
							<option value="">Choose the Category</option>
						</select>
				</div>
				</div>
				<alert class="col-md-5" ng-show="!report.length" type="info"><strong>No data available.</strong></alert>
				<accordion close-others="false" ng-show="report.length">
					<accordion-group is-open="true">
						<accordion-heading>
							<span class="blueText" ng-show="reportView">Report for the selected date range</span>
							<span class="blueText" ng-hide="reportView">Shift Owner Report for the selected date range</span>
						</accordion-heading>
						<table ng-init="report.S1GrandTotal = 0; report.S2GrandTotal = 0; report.S3GrandTotal = 0;" class="table table-condensed table-striped report" ng-show="reportView">
							<tr ng-repeat-start="datum in report | orderBy : orderByDate">
								<td rowspan="6"><strong>{{datum.date}}</strong></td>
								<td></td>
								<td><strong>S1</strong></td>
								<td><strong>S2</strong></td>
								<td><strong>S3</strong></td>
								<td><strong>Total</strong></td>
							</tr>
							<tr>
								<td><strong>FE</strong></td>
								<td>{{datum.S1.members.FE}}</td>
								<td>{{datum.S2.members.FE}}</td>
								<td>{{datum.S3.members.FE}}</td>
								<td><strong>{{datum.S1.members.FE + datum.S2.members.FE + datum.S3.members.FE}}</strong></td>
							</tr>
							<tr>
								<td><strong>SAL</strong></td>
								<td>{{datum.S1.members.SAL}}</td>
								<td>{{datum.S2.members.SAL}}</td>
								<td>{{datum.S3.members.SAL}}</td>
								<td><strong>{{datum.S1.members.SAL + datum.S2.members.SAL + datum.S3.members.SAL}}</strong></td>
							</tr>
							<tr>
								<td><strong>UC-UP</strong></td>
								<td>{{datum.S1.members.UCUP}}</td>
								<td>{{datum.S2.members.UCUP}}</td>
								<td>{{datum.S3.members.UCUP}}</td>
								<td><strong>{{datum.S1.members.UCUP + datum.S2.members.UCUP + datum.S3.members.UCUP}}</strong></td>
							</tr>
							<tr>
								<td><strong>UPAS</strong></td>
								<td>{{datum.S1.members.UPAS}}</td>
								<td>{{datum.S2.members.UPAS}}</td>
								<td>{{datum.S3.members.UPAS}}</td>
								<td><strong>{{datum.S1.members.UPAS + datum.S2.members.UPAS + datum.S3.members.UPAS}}</strong></td>
							</tr>
							<tr ng-repeat-end>
								<td><strong>Total</strong></td>
								<td ng-init="datum.S1Total = datum.S1.members.FE + datum.S1.members.SAL + datum.S1.members.UCUP + datum.S1.members.UPAS; report.S1GrandTotal = report.S1GrandTotal + datum.S1Total;"><strong>{{datum.S1Total}}</strong></td>
								<td ng-init="datum.S2Total = datum.S2.members.FE + datum.S2.members.SAL + datum.S2.members.UCUP + datum.S2.members.UPAS; report.S2GrandTotal = report.S2GrandTotal + datum.S2Total;"><strong>{{datum.S2Total}}</strong></td>
								<td ng-init="datum.S3Total = datum.S3.members.FE + datum.S3.members.SAL + datum.S3.members.UCUP + datum.S3.members.UPAS; report.S3GrandTotal = report.S3GrandTotal + datum.S3Total;"><strong>{{datum.S3Total}}</strong></td>
								<td><strong>{{datum.S1Total + datum.S2Total + datum.S3Total}}</strong></td>
							</tr>
							<tr>
								<td></td>
								<td><strong>GrandTotal</strong></td>
								<td><strong>{{report.S1GrandTotal}}</strong></td>
								<td><strong>{{report.S2GrandTotal}}</strong></td>
								<td><strong>{{report.S3GrandTotal}}</strong></td>
								<td><strong>{{report.S1GrandTotal + report.S2GrandTotal + report.S3GrandTotal}}</strong></td>
							</tr>
						</table>
						<alert class="col-md-5" ng-show="ownerError" type="info"><strong>No data available.</strong></alert>
						<table class="table table-striped table-condensed" ng-hide="reportView || ownerError">
						<thead>
							<tr>
								<th>ShiftOwner Name</th>
								<th>Number of Occurrence</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="(name, count) in ownerCounts | orderBy:count">
								<td>{{name}}</td>
								<td>{{count}}</td>
							</tr>
						</tbody>
					</table>
					</accordion-group>
				</accordion>
			</form>
		</tab>
		  <tab heading="Bridge Entry" ng-controller="AttendanceController">
                       <h3 class="align-Center blueText"><strong>Bridge Details Entry</strong></h3>
                           <form class="panel-body" name="frmBridgeDetails" novalidate>
                           	   <div class="row align-Center">
                                     <div class="col-md-3">
                                           <span class="blueText">Bridge Type*</span>
                                     </div>
                                     <div class="col-md-4">
                                         <select ng-model="inputsbridge.bridgeType" ng-options="bridge.type as bridge.type for bridge in bridgeTypes" class="form-control shiftDropdown">
                                                 <option value="">Bridge Type</option>
                                         </select>
                                     </div>
                                </div><br>
                                <div class="row align-Center">
                                     <div class="col-md-3">
                                           <span class="blueText">Bridge Name*</span>
                                     </div>
                                     <div class="col-md-4">
                                         <input type="text" ng-model="inputsbridge.bridgename" size="50" placeholder ="Bridge Name">
                                     </div>
                                </div><br>
                                <div class="row align-Center">
                                    <div class="col-md-3">
                                           <span class="blueText">Date of Occurance*</span>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="input-group" ng-controller="DateController">
                                          <input type="text" class="form-control" datepicker-popup="yyyy/MM/dd" ng-model="inputsbridge.dateOfbridge" is-open="opened" ng-required="true" close-text="Close" />
                                                <span class="input-group-btn">
                                                     <button type="button" class="btn btn-default" ng-click="openDatePicker($event)"><i class="glyphicon glyphicon-calendar"></i></button>
                                                </span>
                                         </p>
                                    </div>
                                 </div>
                                  <div class="row align-Center">
                                     <div class="col-md-3">
                                           <span class="blueText">Shift in which bridge started*</span>
                                     </div>
                                     <div class="col-md-4">
                                         <select ng-model="inputsbridge.shift" ng-options="shift.shiftNo as shift.shiftNo for shift in shifts" class="form-control shiftDropdown">
                                                 <option value="">Shifts</option>
                                         </select>
                                     </div>
                                      <div class="col-md-2">
                                      	  <span class="blueText"> Start Time (in IST)*</span>
                                      </div>
                                      <div class="col-md-2">
                                      	    <input type="time" ng-model="inputsbridge.bridgeTime" placeholder ="Bridge Name">
                                      </div>
                                </div><br>
                                 <div class="row align-Center">
                                     <div class="col-md-3">
                                         <span class="blueText">Duration (in hours)*</span>
                                     </div>
                                     <div class="col-md-4">
                                         <input type="tel"  placeholder ="Duration in format hh:mm" ng-model="inputsbridge.duration" maxlength="5" size="50">
                                     </div>
                                 </div><br>
                                 <div class="row align-Center">
                                          <span class="blueText"><strong>Hold down the Ctrl (windows) / Command (Mac) button to select multiple options.</strong></span>
                                        </div><br>
                                 <div class="row align-Center">
                                        <div class="col-md-3">
                                            <span class="blueText">Keywords*</span>
                                        </div>
                                        <div class="col-md-4">
                                           <select ng-model="inputsbridge.selectkeywords" ng-options="key.keywordName as key.keywordName for key in keywords" class="form-control shiftDropdown" multiple="multiple">
                                                 <option value="">Shift</option>
                                         </select>
                                        </div>
                                  </div><br>
                                      <div class="row align-Center">
                                          <div class="col-md-3">
                                            <span class="blueText">Primary Participants (Active Involvement):*</span>
                                           </div>
                                       <div class="col-md-4">
                                       	 <select ng-model="inputsbridge.participantsPrimary" ng-options="member._id as member.name for member in members | orderBy:'name'"class="form-control shiftDropdown" multiple="multiple">
                                                 <option value="">Name</option>
                                         </select>
                                         </div>
                                       </div><br>
                                        <div class="row align-Center">
                                          <div class="col-md-3">
                                            <span class="blueText">Secondary Participants :
                                            </span>
                                           </div>
                                       <div class="col-md-4">
                                       	 <select ng-model="inputsbridge.participantsSecondary" ng-options="member._id as member.name for member in members | orderBy:'name'"class="form-control shiftDropdown" multiple="multiple">
                                                 <option value="">Name</option>
                                         </select>
                                         </div>
                                       </div><br>
                                    <div class="row align-Center">
                                            <div class="col-md-3">
                                                  <span class="blueText">Brief summary of the Bridge:*</span>
                                            </div>
                                        <div class="col-md-4">
                                             <textarea rows="4" placeholder ="Brief summary" ng-model="inputsbridge.briefsummary" cols="50"></textarea>
                                        </div>
                                    </div><br>
                                    <div class="row align-Center">
                                            <div class="col-md-3">
                                                <span class="blueText">RCA of the Bridge and Solution done:*</span>
                                            </div>
                                            <div class="col-md-4">
                                                <textarea rows="4" placeholder ="RCA and Solution" ng-model="inputsbridge.solution" cols="50"></textarea>
                                             </div>
                                    </div><br>
                                      <div class="row align-Center">
                                            <div class="col-md-3">
                                                  <span class="blueText">Contacted DLs (If any):</span>
                                            </div>
                                        <div class="col-md-4">
                                             <input placeholder ="Contacted DLs" ng-model="inputsbridge.contactDL" size="50"></input>
                                        </div>
                                    </div><br>
                                        <div class="row align-Center">
                                             <div class="col-md-3">
                                        <span class="blueText">SG Jira Created to track:</span>
                                            </div>
                                        <div class="col-md-4">
                                             <input type="text" ng-model="inputsbridge.SGjira" size="50" placeholder ="SG Jira">
                                         </div>
                                        </div><br>
                                         <div class="row align-Center">
                                            <div class="col-md-3">
                                                <span class="blueText">RCA Jira Created(If any):</span>
                                             </div>
                                         <div class="col-md-4">
                                             <input type="text" ng-model="inputsbridge.RCAjira" size="50" placeholder ="RCA Jira">
                                         </div>
                                         </div><br>
                                          <div class="row align-Center">
                                            <div class="col-md-3">
                                                <span class="blueText">ESOC/OBU Jira Created(If any):</span>
                                             </div>
                                         <div class="col-md-4">
                                             <input type="text" ng-model="inputsbridge.OBUjira" size="50" placeholder ="ESOC/OBU Jira">
                                         </div>
                                         </div><br>
                                     <div class="row align-Center">
                                            <button type="button" class="btn btn-primary" ng-click="submitBridge(inputsbridge)" ng-disabled="{{isDisabled}}">
                                                                   Submit
                                            </button><tr><tr><tr>
                                            <button type="button" class="btn" ng-model="singleModel" ng-click="resetBridge()">
                                                            <strong>Reset</strong>
                                            </button>
                                     </div>
                                      <div class="row align-Center">
                                               <alert class="col-md-6" ng-show="bridgeMandatoryFieldsError" type="danger"><strong>{{errorMessageBridge}}</strong></alert>
                                               <alert class="col-md-5" ng-show="bridgeSuccess" type="info"><strong>{{bridgeDetailsSuccess}}</strong></alert>
                                       </div>
           </form>
      </tab>
      <tab heading="Bridge Tracking" ng-controller="ReportController">
      	<form class="panel-body" name="frmBridgeReport" novalidate>
				<div class="row align-Center">
					<div class="col-md-4">
						<p class="input-group">
							<span class="input-group-addon"><strong>From : </strong></span>
							<input type="text" class="form-control" datepicker-popup="yyyy/MM/dd" ng-model="inputsBridgeReport.startDate" is-open="startDate.opened" ng-required="true" close-text="Close" />
							<span class="input-group-btn">
								<button type="button" class="btn btn-default" ng-click="startDate.openDatePicker($event)"><i class="glyphicon glyphicon-calendar"></i></button>
							</span>
						</p>
					</div>
					<div class="col-md-4">
						<p class="input-group">
							<span class="input-group-addon"><strong>To : </strong></span>
							<input type="text" class="form-control" datepicker-popup="yyyy/MM/dd" ng-model="inputsBridgeReport.endDate" is-open="endDate.opened" ng-required="true" close-text="Close" />
							<span class="input-group-btn">
								<button type="button" class="btn btn-default" ng-click="endDate.openDatePicker($event)"><i class="glyphicon glyphicon-calendar"></i></button>
							</span>
						</p>
					</div>
			    </div><br><br> 
			    <div class="row align-Center myclass">
                        <button type="button" class="btn btn-primary" ng-click="searchBridge(inputsBridgeReport)" ng-disabled="{{isDisabled}}">
                                 <strong>Search</strong>
                        </button>
                </div><br>
                <div class="row align-Center">
                        <alert class="col-md-5" ng-show="bridgesearchFieldsError" type="danger"><strong>Enter required fields to search bridges.</strong></alert>
                	    <alert class="col-md-5" ng-show="!showBridgeReport" type="info"><strong>No data available.</strong></alert>
                </div>
		<accordion close-others="false" ng-show="bridgeReport.length && showBridgeReport">
					<accordion-group is-open="true">
						<accordion-heading>
							<span class="blueText">Bridges for the selected date range</span>
						</accordion-heading>
						<table border="1" border-color="black" class="table table-condensed table-striped report" ng-repeat-start="bridageDay in bridgeReport | orderBy : orderByDate" ng-show="bridageDay.showData">
							<tr ng-repeat-start="bridge in bridageDay.bridges">
								<td rowspan="8" width="10%"><strong>{{bridageDay.date}}</strong></td>
								<td width="30%">Bridge Type :</td>
								<td  colspan="4"><strong>{{bridge.bridgeType}}</strong></td>
							</tr>
							<tr>
								<td width="30%">Bridge Name :</td>
								<td colspan="4"><strong>{{bridge.bridgename}}</strong></td>
							</tr>
							<tr>
								<td width="30%">Bridge Start Time(24 hours format in IST) :</td>
								<td width="20%"><strong>{{bridge.bridgeTime}}</strong></td>
								<td width="20%">Total duration :</td>
								<td colspan="3"><strong>{{bridge.duration}}</strong> Hours</td>
							</tr>	
							<tr>
								<td width="30%">Shift:</td>
								<td width="20%"><strong>{{bridge.shift}}</strong></td>
								<td width="20%">Shift Owner:</td>
								<td colspan="3"><strong>{{bridge.ShiftOwner}}</strong></td>
							</tr>
							<tr>
								<td width="20%">Bridge Summary:</td>
								<td colspan="3">{{bridge.briefsummary}}</td>
							</tr>
							<tr>
								<td width="30%">RCA and Solution :</td>
								<td colspan="4">{{bridge.solution}}</td>
							</tr>
							<tr>
								<td width="30%">DLs contacted :</td>
								<td width="20%"><strong>{{bridge.contactDL}}</strong></td>
								<td width="20%">SG Jira :</td>
								<td colspan="3"><strong>{{bridge.SGjira}}</strong></td>
							</tr>
							<tr>
								<td width="30%">RCA Jira :</td>
								<td width="20%"><strong>{{bridge.RCAjira}}</strong></td>
								<td width="20%">OBU/CHNG Jira if any:</td>
								<td colspan="3"><strong>{{bridge.OBUjira}}</strong></td>
							</tr>
							<tr ng-repeat-end>
						</table>
						<table ng-repeat-end>
					</accordion-group>
				</accordion>
		  </form>				
      </tab>
	</tabset>
</body>
</html>
